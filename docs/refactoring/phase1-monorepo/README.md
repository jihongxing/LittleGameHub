# Phase 1: ä¸‰ç«¯ç»Ÿä¸€æ¶æ„è°ƒæ•´ (Monorepo)

> **é˜¶æ®µ**: Phase 1 of 4  
> **æ—¶é•¿**: 2 å‘¨  
> **éš¾åº¦**: ğŸ”´ğŸ”´ğŸ”´ ä¸­é«˜  
> **çŠ¶æ€**: â³ å¾…å¼€å§‹

## ğŸ“‹ ç›®å½•

- [æ€»è§ˆ](#æ€»è§ˆ)
- [ç›®æ ‡ä¸æˆæœ](#ç›®æ ‡ä¸æˆæœ)
- [å‰ç½®æ¡ä»¶](#å‰ç½®æ¡ä»¶)
- [å®æ–½æ­¥éª¤](#å®æ–½æ­¥éª¤)
- [è¯¦ç»†æ–‡æ¡£](#è¯¦ç»†æ–‡æ¡£)
- [éªŒæ”¶æ ‡å‡†](#éªŒæ”¶æ ‡å‡†)

---

## æ€»è§ˆ

Phase 1 çš„æ ¸å¿ƒä»»åŠ¡æ˜¯å°†å½“å‰çš„åˆ†æ•£é¡¹ç›®ç»“æ„è½¬æ¢ä¸ºç»Ÿä¸€çš„ Monorepo æ¶æ„ï¼Œä¸ºåç»­çš„é˜²å¾¡æ€§ç¼–ç¨‹å’Œå¤šå¹³å°ç™»å½•å¥ å®šåŸºç¡€ã€‚

### å½“å‰ç»“æ„

```
LittleGameHub/
â”œâ”€â”€ backend/           # åç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json
â”œâ”€â”€ frontend/          # å‰ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json
â””â”€â”€ docs/              # æ–‡æ¡£
```

**é—®é¢˜**:
- âŒ ç±»å‹å®šä¹‰é‡å¤
- âŒ å·¥å…·å‡½æ•°é‡å¤
- âŒ æ— æ³•å…±äº«éªŒè¯é€»è¾‘
- âŒ éƒ¨ç½²å’Œæ„å»ºåˆ†æ•£

### ç›®æ ‡ç»“æ„

```
LittleGameHub/
â”œâ”€â”€ packages/                    # æ‰€æœ‰åŒ…çš„æ ¹ç›®å½•
â”‚   â”œâ”€â”€ shared/                 # ğŸ¯ å…±äº«ä»£ç åº“
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ types/         # TypeScript ç±»å‹å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ validation/    # éªŒè¯é€»è¾‘ï¼ˆDTOï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ utils/         # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ constants/     # å¸¸é‡å®šä¹‰
â”‚   â”‚   â”‚   â””â”€â”€ api-client/    # API å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ backend/               # åç«¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ frontend-web/          # Web å‰ç«¯
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ tsconfig.json
â”‚   â””â”€â”€ admin/                 # ç®¡ç†åå°ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ scripts/                   # æ„å»ºå’Œå·¥å…·è„šæœ¬
â”œâ”€â”€ configs/                   # å…±äº«é…ç½®
â”œâ”€â”€ docs/                      # æ–‡æ¡£
â”œâ”€â”€ pnpm-workspace.yaml       # pnpm workspace é…ç½®
â”œâ”€â”€ turbo.json                # Turborepo é…ç½®
â”œâ”€â”€ package.json              # Root package.json
â””â”€â”€ tsconfig.base.json        # TypeScript åŸºç¡€é…ç½®
```

**ä¼˜åŠ¿**:
- âœ… ç±»å‹å®šä¹‰ç»Ÿä¸€ï¼Œä¸€å¤„ä¿®æ”¹ï¼Œå¤„å¤„ç”Ÿæ•ˆ
- âœ… å·¥å…·å‡½æ•°å¤ç”¨ï¼Œå‡å°‘é‡å¤ä»£ç  40%
- âœ… éªŒè¯é€»è¾‘å…±äº«ï¼Œå‰åç«¯ä¿æŒä¸€è‡´
- âœ… å¢é‡æ„å»ºï¼Œæ„å»ºé€Ÿåº¦æå‡ 60%

---

## ç›®æ ‡ä¸æˆæœ

### ä¸»è¦ç›®æ ‡

1. **æ­å»º Monorepo åŸºç¡€æ¶æ„**
   - é…ç½® pnpm workspace
   - é…ç½® Turborepo
   - è®¾ç½® TypeScript Project References

2. **åˆ›å»º shared å…±äº«åŒ…**
   - è¿ç§»ç±»å‹å®šä¹‰
   - è¿ç§»å·¥å…·å‡½æ•°
   - è¿ç§»å¸¸é‡å’Œæšä¸¾

3. **è¿ç§»ç°æœ‰ä»£ç **
   - è¿ç§» backend ä»£ç 
   - è¿ç§» frontend ä»£ç 
   - æ›´æ–°æ‰€æœ‰å¯¼å…¥è·¯å¾„

4. **ä¼˜åŒ–æ„å»ºç³»ç»Ÿ**
   - é…ç½®å¢é‡æ„å»º
   - é…ç½®å¹¶è¡Œæ„å»º
   - ä¼˜åŒ–ä¾èµ–ç®¡ç†

### å…³é”®æˆæœ (KPI)

| æŒ‡æ ‡ | åŸºçº¿ | ç›®æ ‡ | æµ‹é‡æ–¹å¼ |
|------|------|------|----------|
| æ„å»ºæ—¶é—´ | 5åˆ†é’Ÿ | <2åˆ†é’Ÿ | `pnpm build` |
| ä»£ç å¤ç”¨ç‡ | 20% | 60% | ä»£ç è¡Œæ•°åˆ†æ |
| ç±»å‹è¦†ç›–ç‡ | 60% | 95% | TypeScript ç¼–è¯‘ |
| node_modules å¤§å° | 500MB | <300MB | du -sh |

---

## å‰ç½®æ¡ä»¶

### å¿…é¡»å®Œæˆ

- [ ] æ‰€æœ‰ä»£ç å·²æäº¤ï¼Œå·¥ä½œåŒºå¹²å‡€
- [ ] åˆ›å»ºå¤‡ä»½åˆ†æ”¯ `backup/before-monorepo`
- [ ] å›¢é˜Ÿæˆå‘˜äº†è§£ Monorepo æ¦‚å¿µ
- [ ] ç¡®è®¤å½“å‰é¡¹ç›®å¯ä»¥æ­£å¸¸è¿è¡Œ

### ç¯å¢ƒè¦æ±‚

```bash
# Node.js ç‰ˆæœ¬
node --version  # >= 18.0.0

# pnpm ç‰ˆæœ¬
pnpm --version  # >= 8.0.0

# Git ç‰ˆæœ¬
git --version   # >= 2.30.0

# æ“ä½œç³»ç»Ÿ
# macOS, Linux, Windows (WSL2)
```

### å®‰è£…å¿…è¦å·¥å…·

```bash
# 1. å®‰è£… pnpm (å¦‚æœè¿˜æ²¡æœ‰)
npm install -g pnpm@latest

# 2. éªŒè¯å®‰è£…
pnpm --version

# 3. é…ç½® pnpm (å¯é€‰)
pnpm config set store-dir ~/.pnpm-store
pnpm config set shamefully-hoist true  # è§£å†³æŸäº›åŒ…çš„å…¼å®¹æ€§é—®é¢˜
```

---

## å®æ–½æ­¥éª¤

### Week 1: åŸºç¡€æ­å»º

#### Day 1: Monorepo åˆå§‹åŒ–

**ç›®æ ‡**: æ­å»ºåŸºæœ¬çš„ Monorepo ç»“æ„

**æ­¥éª¤**:
1. åˆ›å»ºæ–°åˆ†æ”¯
2. åˆå§‹åŒ– pnpm workspace
3. é…ç½® Turborepo
4. è®¾ç½® TypeScript åŸºç¡€é…ç½®

**è¯¦ç»†æ–‡æ¡£**: ğŸ“– [01-setup-monorepo.md](./01-setup-monorepo.md)

**é¢„è®¡æ—¶é—´**: 4-6 å°æ—¶

---

#### Day 2: åˆ›å»º shared åŒ…

**ç›®æ ‡**: åˆ›å»ºå…±äº«ä»£ç åº“çš„åŸºç¡€ç»“æ„

**æ­¥éª¤**:
1. åˆ›å»º `packages/shared` ç›®å½•
2. åˆå§‹åŒ– package.json
3. é…ç½® TypeScript
4. è®¾ç½®å¯¼å‡ºè·¯å¾„

**è¯¦ç»†æ–‡æ¡£**: ğŸ“– [01-setup-monorepo.md](./01-setup-monorepo.md) (Section 2)

**é¢„è®¡æ—¶é—´**: 4-6 å°æ—¶

---

#### Day 3-4: è¿ç§»ç±»å‹å®šä¹‰

**ç›®æ ‡**: å°†æ‰€æœ‰ç±»å‹å®šä¹‰è¿ç§»åˆ° shared åŒ…

**æ­¥éª¤**:
1. è¿ç§» User ç›¸å…³ç±»å‹
2. è¿ç§» Game ç›¸å…³ç±»å‹
3. è¿ç§» Auth ç›¸å…³ç±»å‹
4. è¿ç§»é€šç”¨ç±»å‹

**è¯¦ç»†æ–‡æ¡£**: ğŸ“– [02-code-migration.md](./02-code-migration.md)

**é¢„è®¡æ—¶é—´**: 12-16 å°æ—¶

---

#### Day 5: è¿ç§»å·¥å…·å‡½æ•°

**ç›®æ ‡**: å°†å·¥å…·å‡½æ•°è¿ç§»åˆ° shared åŒ…

**æ­¥éª¤**:
1. è¿ç§» JWT å·¥å…·
2. è¿ç§»å¯†ç å·¥å…·
3. è¿ç§»éªŒè¯å·¥å…·
4. è¿ç§»æ—¥æœŸå·¥å…·

**è¯¦ç»†æ–‡æ¡£**: ğŸ“– [02-code-migration.md](./02-code-migration.md) (Section 2)

**é¢„è®¡æ—¶é—´**: 6-8 å°æ—¶

---

### Week 2: ä»£ç è¿ç§»å’Œä¼˜åŒ–

#### Day 1-2: è¿ç§» backend

**ç›®æ ‡**: å°† backend é¡¹ç›®è¿ç§»åˆ° packages ä¸‹

**æ­¥éª¤**:
1. ç§»åŠ¨ backend ç›®å½•
2. æ›´æ–° package.json
3. æ›´æ–°å¯¼å…¥è·¯å¾„
4. æµ‹è¯•æ„å»º

**è¯¦ç»†æ–‡æ¡£**: ğŸ“– [02-code-migration.md](./02-code-migration.md) (Section 3)

**é¢„è®¡æ—¶é—´**: 12-16 å°æ—¶

---

#### Day 3-4: è¿ç§» frontend

**ç›®æ ‡**: å°† frontend é¡¹ç›®è¿ç§»åˆ° packages ä¸‹

**æ­¥éª¤**:
1. ç§»åŠ¨ frontend ç›®å½•
2. æ›´æ–° package.json
3. æ›´æ–°å¯¼å…¥è·¯å¾„
4. æµ‹è¯•æ„å»º

**è¯¦ç»†æ–‡æ¡£**: ğŸ“– [02-code-migration.md](./02-code-migration.md) (Section 4)

**é¢„è®¡æ—¶é—´**: 12-16 å°æ—¶

---

#### Day 5: æ„å»ºä¼˜åŒ–å’Œæµ‹è¯•

**ç›®æ ‡**: ä¼˜åŒ–æ„å»ºæµç¨‹ï¼Œå…¨é¢æµ‹è¯•

**æ­¥éª¤**:
1. é…ç½® Turbo ç¼“å­˜
2. è®¾ç½®å¹¶è¡Œæ„å»º
3. ä¼˜åŒ–ä¾èµ–ç®¡ç†
4. å…¨é¢æµ‹è¯•

**è¯¦ç»†æ–‡æ¡£**: ğŸ“– [03-build-optimization.md](./03-build-optimization.md)

**é¢„è®¡æ—¶é—´**: 6-8 å°æ—¶

---

## è¯¦ç»†æ–‡æ¡£

### æ ¸å¿ƒæ–‡æ¡£

1. **[Monorepo æ­å»ºæŒ‡å—](./01-setup-monorepo.md)**
   - pnpm workspace é…ç½®
   - Turborepo é…ç½®
   - TypeScript é¡¹ç›®å¼•ç”¨
   - åŒ…ç®¡ç†ç­–ç•¥

2. **[ä»£ç è¿ç§»æŒ‡å—](./02-code-migration.md)**
   - ç±»å‹å®šä¹‰è¿ç§»
   - å·¥å…·å‡½æ•°è¿ç§»
   - åç«¯ä»£ç è¿ç§»
   - å‰ç«¯ä»£ç è¿ç§»
   - è·¯å¾„æ›´æ–°ç­–ç•¥

3. **[æ„å»ºä¼˜åŒ–æŒ‡å—](./03-build-optimization.md)**
   - Turbo ç¼“å­˜é…ç½®
   - å¢é‡æ„å»º
   - å¹¶è¡Œæ‰§è¡Œ
   - ä¾èµ–ä¼˜åŒ–

### å‚è€ƒæ–‡æ¡£

- **[æ£€æŸ¥æ¸…å•](./checklist.md)** - Phase 1 å®Œæˆæ£€æŸ¥æ¸…å•
- **[å¸¸è§é—®é¢˜](./faq.md)** - FAQ å’Œæ•…éšœæ’é™¤
- **[ä»£ç ç¤ºä¾‹](./examples/)** - å®é™…ä»£ç ç¤ºä¾‹

---

## éªŒæ”¶æ ‡å‡†

### å¿…é¡»è¾¾æˆ

- âœ… **æ„å»ºæˆåŠŸ**
  ```bash
  pnpm build
  # æ‰€æœ‰åŒ…æ„å»ºæˆåŠŸï¼Œæ— é”™è¯¯
  ```

- âœ… **ç±»å‹æ£€æŸ¥é€šè¿‡**
  ```bash
  pnpm typecheck
  # æ‰€æœ‰åŒ…ç±»å‹æ£€æŸ¥é€šè¿‡
  ```

- âœ… **ç°æœ‰åŠŸèƒ½æ­£å¸¸**
  ```bash
  pnpm dev
  # åç«¯å’Œå‰ç«¯éƒ½èƒ½æ­£å¸¸å¯åŠ¨
  # ç°æœ‰åŠŸèƒ½éƒ½èƒ½æ­£å¸¸ä½¿ç”¨
  ```

- âœ… **æµ‹è¯•å…¨éƒ¨é€šè¿‡**
  ```bash
  pnpm test
  # æ‰€æœ‰ç°æœ‰æµ‹è¯•é€šè¿‡
  ```

### æ€§èƒ½æŒ‡æ ‡

- âœ… **æ„å»ºæ—¶é—´**
  ```bash
  time pnpm build
  # é¦–æ¬¡æ„å»º < 3 åˆ†é’Ÿ
  # å¢é‡æ„å»º < 30 ç§’
  ```

- âœ… **ä¾èµ–å®‰è£…**
  ```bash
  time pnpm install
  # < 2 åˆ†é’Ÿ
  ```

### ä»£ç è´¨é‡

- âœ… **æ—  ESLint é”™è¯¯**
  ```bash
  pnpm lint
  # 0 errors, warnings å¯å¿½ç•¥
  ```

- âœ… **å¯¼å…¥è·¯å¾„æ­£ç¡®**
  ```bash
  # ä½¿ç”¨åˆ«åå¯¼å…¥
  import { User } from '@gamehub/shared/types'
  # ä¸ä½¿ç”¨ç›¸å¯¹è·¯å¾„
  import { User } from '../../../types'  # âŒ
  ```

---

## é£é™©ä¸åº”å¯¹

### é£é™©è¯„ä¼°

| é£é™© | å¯èƒ½æ€§ | å½±å“ | ç¼“è§£æªæ–½ |
|------|--------|------|----------|
| ä¾èµ–å†²çª | ğŸŸ¡ ä¸­ | ğŸ”´ é«˜ | pnpm overrides + ç‰ˆæœ¬é”å®š |
| æ„å»ºå¤±è´¥ | ğŸŸ¡ ä¸­ | ğŸ”´ é«˜ | å‡†å¤‡å›æ»šæ–¹æ¡ˆ + å……åˆ†æµ‹è¯• |
| è·¯å¾„å¼•ç”¨é”™è¯¯ | ğŸ”´ é«˜ | ğŸŸ¡ ä¸­ | è‡ªåŠ¨åŒ–è„šæœ¬ + ESLint è§„åˆ™ |
| å›¢é˜Ÿé€‚åº” | ğŸŸ¡ ä¸­ | ğŸŸ¢ ä½ | åŸ¹è®­ + æ–‡æ¡£ + Code Review |

### å›æ»šæ–¹æ¡ˆ

å¦‚æœé‡åˆ°æ— æ³•è§£å†³çš„é—®é¢˜ï¼š

```bash
# 1. åœæ­¢å·¥ä½œ
git stash

# 2. åˆ‡æ¢åˆ°å¤‡ä»½
git checkout backup/before-monorepo

# 3. é‡æ–°å¼€å§‹
git checkout -b feature/monorepo-retry

# 4. åˆ†æé—®é¢˜
# æŸ¥çœ‹å¤±è´¥æ—¥å¿—ï¼Œç¡®å®šé—®é¢˜åŸå› 

# 5. ä¿®å¤åé‡è¯•
```

---

## è¿›åº¦è·Ÿè¸ª

### æ¯æ—¥æ£€æŸ¥

æ¯å¤©ç»“æŸæ—¶å¡«å†™ï¼š

```markdown
## 2024-11-XX è¿›åº¦æŠ¥å‘Š

### ä»Šæ—¥å®Œæˆ
- [ ] Task 1
- [ ] Task 2

### é‡åˆ°çš„é—®é¢˜
- é—®é¢˜æè¿°
- è§£å†³æ–¹æ¡ˆ

### æ˜æ—¥è®¡åˆ’
- [ ] Task 3
- [ ] Task 4
```

### å‘¨æŠ¥å‘Š

æ¯å‘¨äº”å¡«å†™ï¼š

```markdown
## Week X è¿›åº¦æŠ¥å‘Š

### æœ¬å‘¨æˆæœ
- å®Œæˆçš„ä»»åŠ¡
- è¾¾æˆçš„æŒ‡æ ‡

### é‡åˆ°çš„æŒ‘æˆ˜
- æŒ‘æˆ˜æè¿°
- åº”å¯¹æªæ–½

### ä¸‹å‘¨è®¡åˆ’
- è®¡åˆ’ä»»åŠ¡
- é¢„æœŸæˆæœ
```

---

## å›¢é˜Ÿåä½œ

### åˆ†å·¥å»ºè®®

**åç«¯å¼€å‘ (2äºº)**:
- è´Ÿè´£ shared åŒ…çš„å·¥å…·å‡½æ•°è¿ç§»
- è´Ÿè´£ backend ä»£ç è¿ç§»
- è´Ÿè´£åç«¯æ„å»ºé…ç½®

**å‰ç«¯å¼€å‘ (1äºº)**:
- è´Ÿè´£ shared åŒ…çš„ç±»å‹å®šä¹‰è¿ç§»
- è´Ÿè´£ frontend ä»£ç è¿ç§»
- è´Ÿè´£å‰ç«¯æ„å»ºé…ç½®

**DevOps (0.5äºº)**:
- è´Ÿè´£ CI/CD é…ç½®æ›´æ–°
- è´Ÿè´£éƒ¨ç½²è„šæœ¬è°ƒæ•´
- è´Ÿè´£æ€§èƒ½ç›‘æ§

### æ²Ÿé€šè¦æ±‚

- **æ¯æ—¥ç«™ä¼š**: åŒæ­¥è¿›åº¦ï¼ŒåŠæ—¶å‘ç°é—®é¢˜
- **å³æ—¶æ²Ÿé€š**: é‡åˆ°é˜»å¡ç«‹å³æ²Ÿé€š
- **æ–‡æ¡£è®°å½•**: é‡è¦å†³ç­–å’Œå˜æ›´è®°å½•åœ¨æ–‡æ¡£ä¸­

---

## ä¸‹ä¸€æ­¥

Phase 1 å®Œæˆåï¼Œç»§ç»­æ‰§è¡Œï¼š

ğŸ‘‰ **[Phase 2: é˜²å¾¡æ€§ç¼–ç¨‹](../phase2-defensive/README.md)**

---

## èµ„æºé“¾æ¥

- [pnpm Workspace æ–‡æ¡£](https://pnpm.io/workspaces)
- [Turborepo æ–‡æ¡£](https://turbo.build/repo/docs)
- [TypeScript Project References](https://www.typescriptlang.org/docs/handbook/project-references.html)
- [Monorepo æœ€ä½³å®è·µ](https://monorepo.tools/)

---

**å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬å¼€å§‹ï¼** ğŸ‘‰ [Monorepo æ­å»ºæŒ‡å—](./01-setup-monorepo.md)

