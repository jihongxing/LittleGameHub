# GameHub 开发规范

## 1. 前端开发规范

### 1.1 技术栈选择
- **框架**：React 18+ (函数组件 + Hooks)
- **状态管理**：Redux Toolkit + RTK Query
- **路由**：React Router v6
- **UI组件库**：Ant Design / Material-UI
- **样式方案**：CSS Modules + Styled Components
- **构建工具**：Vite
- **代码规范**：ESLint + Prettier + Husky
- **测试框架**：Jest + React Testing Library

### 1.2 项目结构
```
src/
├── components/          # 通用组件
│   ├── common/         # 基础组件
│   ├── business/       # 业务组件
│   └── layout/         # 布局组件
├── pages/              # 页面组件
│   ├── Home/           # 首页
│   ├── Game/           # 游戏相关页面
│   ├── User/           # 用户相关页面
│   └── Offline/        # 离线功能页面
├── hooks/              # 自定义Hooks
├── services/           # API服务
├── store/              # 状态管理
├── utils/              # 工具函数
├── constants/          # 常量定义
├── styles/             # 全局样式
└── assets/             # 静态资源
```

### 1.3 组件开发规范
- **组件命名**：使用PascalCase，语义化命名
- **文件命名**：组件名与文件名保持一致
- **Props定义**：使用TypeScript接口定义，提供默认值
- **状态管理**：优先使用本地状态，复杂状态使用Redux
- **副作用**：使用useEffect处理副作用，注意依赖项
- **性能优化**：合理使用React.memo、useMemo、useCallback

### 1.4 离线功能开发规范
- **PWA配置**：配置manifest.json和Service Worker
- **缓存策略**：使用Workbox实现缓存策略
- **离线存储**：使用IndexedDB存储游戏数据和资源
- **离线检测**：实现网络状态检测和提示
- **断点续传**：实现下载任务的断点续传功能
- **增量更新**：实现游戏资源的增量更新机制

## 2. 后端开发规范

### 2.1 技术栈选择
- **运行时**：Node.js 18+
- **框架**：Express.js / Koa.js
- **数据库**：MySQL 8.0+ (主数据库) + Redis (缓存)
- **ORM**：Prisma / TypeORM
- **API文档**：Swagger/OpenAPI
- **认证授权**：JWT + OAuth 2.0
- **消息队列**：Redis / RabbitMQ
- **日志管理**：Winston + Morgan
- **测试框架**：Jest + Supertest

### 2.2 项目结构
```
src/
├── controllers/        # 控制器
├── services/           # 业务逻辑
├── models/             # 数据模型
├── middleware/         # 中间件
├── routes/             # 路由定义
├── utils/              # 工具函数
├── config/             # 配置文件
├── validators/         # 数据验证
├── database/           # 数据库相关
├── cache/              # 缓存相关
└── jobs/               # 定时任务
```

### 2.3 API设计规范
- **RESTful风格**：遵循RESTful API设计原则
- **统一响应格式**：定义统一的API响应格式
- **错误处理**：统一的错误处理和错误码
- **版本控制**：API版本控制策略
- **分页机制**：统一的分页参数和响应格式
- **参数验证**：请求数据验证和过滤

### 2.4 微服务规范
- **服务拆分**：按业务领域拆分微服务
- **服务通信**：使用HTTP/REST或消息队列
- **服务发现**：实现服务注册与发现机制
- **负载均衡**：实现服务负载均衡
- **熔断降级**：实现熔断和降级机制
- **链路追踪**：实现分布式链路追踪

## 3. 数据库设计规范

### 3.1 设计原则
- **范式遵循**：遵循数据库设计范式，避免冗余
- **性能优化**：合理设计索引，优化查询性能
- **扩展性**：考虑未来扩展需求，预留扩展空间
- **数据安全**：敏感数据加密存储，访问权限控制
- **数据一致性**：保证数据一致性和完整性

### 3.2 命名规范
- **表名**：使用小写字母和下划线，复数形式
- **字段名**：使用小写字母和下划线，语义化命名
- **索引名**：使用idx_前缀，包含表名和字段名
- **外键名**：使用fk_前缀，包含关联表和字段
- **约束名**：使用约束类型前缀，描述性命名

### 3.3 字段设计规范
- **主键**：使用自增整数ID作为主键
- **时间字段**：使用datetime类型，包含创建时间和更新时间
- **状态字段**：使用tinyint或enum类型，定义状态常量
- **金额字段**：使用decimal类型，避免精度丢失
- **JSON字段**：合理使用JSON类型存储非结构化数据

### 3.4 离线数据设计
- **离线资源表**：存储游戏资源信息和版本
- **下载任务表**：管理用户下载任务和进度
- **离线权限表**：管理用户离线权限和订阅
- **增量更新表**：记录资源更新历史和差异
- **离线使用表**：统计离线功能使用情况

## 4. 测试规范

### 4.1 测试策略
- **单元测试**：覆盖核心业务逻辑和工具函数
- **集成测试**：测试模块间交互和数据流
- **端到端测试**：测试完整用户流程和场景
- **性能测试**：测试系统性能和负载能力
- **安全测试**：测试系统安全性和漏洞

### 4.2 测试编写规范
- **测试命名**：使用描述性命名，明确测试意图
- **测试结构**：使用AAA模式（Arrange, Act, Assert）
- **测试隔离**：确保测试间相互独立，不共享状态
- **测试数据**：使用模拟数据，避免依赖外部数据
- **断言清晰**：使用明确的断言，提供有意义的错误信息

### 4.3 离线功能测试
- **离线下载测试**：测试下载功能和断点续传
- **离线更新测试**：测试增量更新和版本管理
- **离线使用测试**：测试离线环境下的游戏体验
- **网络切换测试**：测试网络状态切换的处理
- **存储管理测试**：测试本地存储空间管理

## 5. 部署与运维规范

### 5.1 环境管理
- **环境划分**：开发环境、测试环境、预生产环境、生产环境
- **环境隔离**：确保环境间相互独立，避免交叉影响
- **配置管理**：统一配置管理，敏感信息加密存储
- **依赖管理**：统一依赖版本，避免版本冲突
- **资源管理**：合理分配资源，监控资源使用情况

### 5.2 部署流程
- **代码审查**：代码提交前必须经过审查
- **自动化构建**：使用CI/CD工具实现自动化构建
- **自动化测试**：构建过程中自动运行测试
- **自动化部署**：使用CD工具实现自动化部署
- **部署验证**：部署后自动验证系统功能

### 5.3 监控与告警
- **系统监控**：监控系统资源使用情况
- **应用监控**：监控应用性能和错误
- **业务监控**：监控关键业务指标
- **日志管理**：统一日志收集和分析
- **告警机制**：设置合理的告警阈值和通知机制

## 6. 安全规范

### 6.1 认证与授权
- **身份认证**：实现多因素认证和单点登录
- **权限控制**：实现基于角色的访问控制(RBAC)
- **会话管理**：安全管理用户会话和令牌
- **API安全**：实现API访问控制和限流
- **密码策略**：强制使用强密码和定期更换

### 6.2 数据安全
- **数据加密**：敏感数据加密存储和传输
- **数据脱敏**：开发环境使用脱敏数据
- **数据备份**：定期备份数据并测试恢复
- **数据审计**：记录数据访问和修改日志
- **隐私保护**：遵守隐私法规，保护用户隐私

### 6.3 系统安全
- **漏洞扫描**：定期进行安全漏洞扫描
- **安全加固**：及时修复安全漏洞
- **安全测试**：进行安全渗透测试
- **安全培训**：定期进行安全意识培训
- **应急响应**：制定安全事件应急响应计划

## 7. 文档规范

### 7.1 代码文档
- **注释规范**：编写清晰的代码注释
- **API文档**：使用Swagger生成API文档
- **架构文档**：编写系统架构和设计文档
- **部署文档**：编写部署和运维文档
- **用户手册**：编写用户使用手册

### 7.2 文档管理
- **文档版本**：使用版本控制管理文档
- **文档审查**：文档发布前进行审查
- **文档更新**：及时更新文档保持同步
- **文档存储**：统一存储和管理文档
- **文档检索**：提供文档检索和查询功能

## 8. Git工作流规范

### 8.1 分支策略
- **主分支**：main/master分支用于生产环境
- **开发分支**：develop分支用于集成开发
- **功能分支**：feature/xxx分支用于功能开发
- **修复分支**：hotfix/xxx分支用于紧急修复
- **发布分支**：release/xxx分支用于发布准备

### 8.2 提交规范
- **提交信息**：使用约定式提交格式
- **提交频率**：合理控制提交频率和粒度
- **代码审查**：提交前进行代码审查
- **测试通过**：确保测试通过后再提交
- **分支保护**：设置分支保护规则

### 8.3 合并策略
- **合并方式**：使用squash merge保持历史清洁
- **合并时机**：在CI/CD通过后合并代码
- **冲突解决**：及时解决合并冲突
- **回滚策略**：制定代码回滚策略
- **发布标记**：使用标记管理版本发布

---

## 规范执行

本开发规范是GameHub项目宪章的具体实施细则，所有团队成员必须严格遵守。规范将根据项目发展和团队反馈持续优化和完善。

**生效日期**：2023年12月
**版本号**：v1.0